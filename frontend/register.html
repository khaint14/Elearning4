<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>Đăng ký</title>
    <link rel="stylesheet" href="style/register.css" />
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Đăng ký</h2>

        <label for="fullname">Họ và tên</label>
        <input id="fullname" placeholder="Họ và tên" />

        <label for="age">Tuổi</label>
        <input id="age" type="number" placeholder="Tuổi" min="1" />

        <label for="username">Tên đăng nhập</label>
        <input id="username" placeholder="Tên đăng nhập" />

        <label for="password">Mật khẩu</label>
        <input id="password" type="password" placeholder="Mật khẩu" />

        <label for="confirmPassword">Nhắc lại mật khẩu</label>
        <input
          id="confirmPassword"
          type="password"
          placeholder="Nhắc lại mật khẩu"
        />

        <div class="checkbox-container">
          <input type="checkbox" id="showPw" onclick="togglePassword()" />
          <label for="showPw" style="font-size: 14px; margin-bottom: 10px">
            Hiển thị mật khẩu
          </label>
        </div>

        <button onclick="register()">Đăng ký</button>
        <p id="msg"></p>
      </div>
    </div>

    <script>
      // ✅ Hiển thị / ẩn mật khẩu
      function togglePassword() {
        const pw = document.getElementById("password");
        const cpw = document.getElementById("confirmPassword");
        const type = pw.type === "password" ? "text" : "password";
        pw.type = type;
        cpw.type = type;
      }

      // ✅ Xử lý đăng ký
      async function register() {
        const fullname = document.getElementById("fullname").value.trim();
        const age = parseInt(document.getElementById("age").value.trim());
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const msg = document.getElementById("msg");

        // Kiểm tra dữ liệu đầu vào
        if (!fullname || !age || !username || !password || !confirmPassword) {
          msg.innerText = "⚠️ Vui lòng nhập đầy đủ thông tin!";
          msg.style.color = "red";
          return;
        }

        if (age < 1) {
          msg.innerText = "⚠️ Tuổi phải lớn hơn 0!";
          msg.style.color = "red";
          return;
        }

        if (password.length < 6) {
          msg.innerText = "⚠️ Mật khẩu phải từ 6 ký tự trở lên!";
          msg.style.color = "red";
          return;
        }

        if (password !== confirmPassword) {
          msg.innerText = "⚠️ Mật khẩu nhập lại không khớp!";
          msg.style.color = "red";
          return;
        }

        // Gửi request tới backend
        const res = await fetch("/api/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fullname, age, username, password }),
        });

        const data = await res.json();
        msg.innerText = data.message;

        if (res.ok) {
          msg.style.color = "green";
          setTimeout(() => (window.location.href = "/login.html"), 1500);
        } else {
          msg.style.color = "red";
        }
      }
    </script>
  </body>
</html>
